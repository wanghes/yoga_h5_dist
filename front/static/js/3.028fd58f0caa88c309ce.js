webpackJsonp([3],{FNhj:function(e,t,a){e.exports=a.p+"static/img/xilie_cover.f167438.png"},tQqs:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("KH7x"),n=a.n(r),s=a("lC5x"),o=a.n(s),i=a("J0Oq"),c=a.n(i),l=a("h0S9"),u=a("FNhj"),p={name:"CourseIndex",data:function(){return{formLabelWidth:"120px",tableData:[],searchName:"",pageSize:5,currentPage:1,cates:[],visible:!1,total:0,course_cover:u,cate_selected:"",showMoney:!0,showMoneyByTime:!1,dialogVisible:!1,multipleSelection:[],aloneCurrentPage:1,alonePageSize:5,allCoursesTotal:0,allCourses:[],cuxiaoVisible:!1,form:{course_name:"",pay_type:1,pay_money_type:[{price:"",time:""}]},saleForm:{cuxiao_id:"",cu_price:""},payTypes:[{id:1,name:"固定收费"}],batchPid:""}},mounted:function(){var e=this;return c()(o.a.mark(function t(){var a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.getCates();case 2:a=t.sent,e.cates=a.data,e.fetData();case 5:case"end":return t.stop()}},t,e)}))()},methods:{fetData:function(){var e=this;return c()(o.a.mark(function t(){var a,r,n,s;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.many_list({page:e.currentPage,pageSize:e.pageSize,course_cate:e.cate_selected,course_name:e.searchName});case 2:a=t.sent,r=a.data,n=r.list,s=r.total,n=e.setListItemCateName(n),e.tableData=n,e.total=s;case 7:case"end":return t.stop()}},t,e)}))()},setListItemCateName:function(e){var t=this;return e.forEach(function(e){t.cates.forEach(function(t){e.course_cate==t.id&&(e.course_cate_name=t.name)})}),e},cateChange:function(){this.currentPage=1,this.fetData()},nameChange:function(){this.fetData()},handleSizeChange:function(e){this.pageSize=e,this.fetData()},handleCurrentChange:function(e){this.currentPage=e,this.fetData()},toAddCourse:function(){this.visible=!0},createCourse:function(){var e=this;return c()(o.a.mark(function t(){var a,r,n,s,i,c,u,p,d,_,m;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.form,r=a.pay_type,n=a.course_name,s=a.pay_money_type,(i={course_name:n,pay_type:parseInt(r),pay_money_type:[]}).course_name){t.next=7;break}return e.$message.error("请填写课程名称"),t.abrupt("return");case 7:if(i.pay_type){t.next=12;break}return e.$message.error("请选择收费类型"),t.abrupt("return");case 12:if(1!=r){t.next=21;break}if(c=!1,s.forEach(function(e){e.price||(c=!0)}),!c){t.next=18;break}return e.$message.error("请填写收费金额"),t.abrupt("return");case 18:i.pay_money_type=s,t.next=38;break;case 21:u=!1,p=0;case 23:if(!(p<s.length)){t.next=34;break}if(d=s[p],!isNaN(d.time)){t.next=28;break}return u=!0,t.abrupt("break",34);case 28:if(!(d.time<=0)&&d.price){t.next=31;break}return u=!0,t.abrupt("break",34);case 31:p++,t.next=23;break;case 34:if(!u){t.next=37;break}return e.$message.error("请填写正确的时间或者金额相数据"),t.abrupt("return");case 37:i.pay_money_type=s;case 38:return t.next=40,l.many_add(i);case 40:_=t.sent,e.visible=!1,m=_.data.insertId,e.$alert("新建系列课成功",{confirmButtonText:"去优化",callback:function(t){e.$router.push({path:"/course/many_detail/"+m})}});case 44:case"end":return t.stop()}},t,e)}))()},intoPlay:function(e){var t=e.id;this.$router.push({path:"/course/many_detail/"+t})},intoEdit:function(e){var t=e.id;this.$router.push({path:"/course/many_detail/"+t})},changePayType:function(e){e=parseInt(e);this.showMoney=!1,this.showMoneyByTime=!1,1==e?this.showMoney=!0:(this.showMoneyByTime=!0,this.form.pay_money_type=[{time:"",pay_money:""}])},handleCommand:function(e){var t=e.split("|"),a=n()(t,2),r=a[0],s=a[1];switch(r){case"a":this.$router.push({path:"/course/add",query:{pid:s}});break;case"b":this.addHasCourse(s);break;case"c":break;case"d":this.operateOnline(s);break;case"e":this.cuxiao(s)}},handleSale:function(e){var t=e.split("|"),a=n()(t,2),r=a[0],s=a[1];switch(r){case"a":this.cuxiao(s);break;case"b":this.cancelCuxiao(s)}},cuxiao:function(e){this.cuxiaoVisible=!0,this.saleForm.cuxiao_id=e},cancelCuxiao:function(e){var t=this;return c()(o.a.mark(function a(){var r;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,l.updateCu({id:e,cu_price:0,cu_status:0});case 2:200==(r=a.sent).code&&(t.cuxiaoVisible=!1,t.$message.success(r.msg),t.fetData());case 4:case"end":return a.stop()}},a,t)}))()},addCu:function(){var e=this;return c()(o.a.mark(function t(){var a,r,n,s;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.saleForm,r=a.cu_price,n=a.cuxiao_id,t.next=3,l.updateCu({id:n,cu_price:r,cu_status:1});case 3:200==(s=t.sent).code&&(e.cuxiaoVisible=!1,e.$message.success(s.msg),e.fetData());case 5:case"end":return t.stop()}},t,e)}))()},operateOnline:function(e){var t=this;return c()(o.a.mark(function a(){var r,n;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return r=0,t.tableData.forEach(function(t){t.id==e&&(r=t.on)}),a.next=4,l.updateOnline({id:e,on:0==r?1:0});case 4:200==(n=a.sent).code&&(t.$message.success(n.msg),t.fetData());case 6:case"end":return a.stop()}},a,t)}))()},jumpPage:function(e){var t=e.id;this.$router.push({path:"/course/many_panel",query:{id:t}})},addTypeByTime:function(){this.form.pay_money_type.push({time:"",pay_money:""})},delPayMonnyItem:function(e){this.form.pay_money_type.splice(e,1),console.log(this.form.pay_money_type)},addHasCourse:function(e){this.dialogVisible=!0,this.batchPid=e,this.getAllAloneCourses()},getAllAloneCourses:function(){var e=this;return c()(o.a.mark(function t(){var a,r,n,s;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.list({page:e.aloneCurrentPage,pageSize:e.alonePageSize,status:""});case 2:a=t.sent,r=a.data,n=r.list,s=r.total,e.allCourses=n,e.allCoursesTotal=s;case 6:case"end":return t.stop()}},t,e)}))()},handleAloneCurrentChange:function(e){this.aloneCurrentPage=e,this.getAllAloneCourses()},handleSelectionChange:function(e){this.multipleSelection=e},okAdd:function(){var e=this;return c()(o.a.mark(function t(){var a,r,n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.multipleSelection,r=[],a.forEach(function(e){r.push(e.id)}),r.length){t.next=6;break}return e.$message.error("请选择要添加的课程"),t.abrupt("return");case 6:return t.next=8,l.batchPids({ids:r,pid:e.batchPid});case 8:n=t.sent,e.dialogVisible=!1,n&&(e.$message.success("添加完成"),e.batchPid="");case 11:case"end":return t.stop()}},t,e)}))()},setJingpin:function(e){var t=this;return c()(o.a.mark(function a(){var r;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,l.updateManyJingpin({id:e.id,jingpin:1});case 2:200==(r=a.sent).code&&(t.$message.success(r.msg),t.fetData());case 4:case"end":return a.stop()}},a,t)}))()},cancelJingpin:function(e){var t=this;return c()(o.a.mark(function a(){var r;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,l.updateManyJingpin({id:e.id,jingpin:0});case 2:200==(r=a.sent).code&&(t.$message.success(r.msg),t.fetData());case 4:case"end":return a.stop()}},a,t)}))()}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wrap"},[a("div",{staticClass:"top_info"},[a("el-button-group",{staticClass:"btn_wrap"},[a("el-button",{attrs:{type:"primary"},on:{click:e.toAddCourse}},[e._v("新建系列课")])],1),e._v(" "),a("div",{staticClass:"right_search"},[a("label",{staticClass:"label"},[e._v("按课程分类搜索：")]),e._v(" "),a("el-select",{attrs:{placeholder:"请选择",clearable:""},on:{change:e.cateChange},model:{value:e.cate_selected,callback:function(t){e.cate_selected=t},expression:"cate_selected"}},e._l(e.cates,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1),e._v(" "),a("el-input",{staticClass:"input_search",attrs:{placeholder:"请输入系列课名称",clearable:""},on:{clear:e.nameChange},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.nameChange(t)}},model:{value:e.searchName,callback:function(t){e.searchName=t},expression:"searchName"}},[a("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:e.nameChange},slot:"suffix"})])],1)],1),e._v(" "),a("el-table",{attrs:{data:e.tableData,"header-cell-style":{"background-color":"#f9fbff",height:"80px",color:"rgba(43,57,64,.85)","border-bottom":"1px #f0f0f0 solid","border-top":"1px #f0f0f0 solid"}}},[a("el-table-column",{attrs:{prop:"course_cover",width:"150",label:"封面"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.course_cover?a("img",{staticClass:"cover",attrs:{src:t.row.course_cover}}):a("img",{staticClass:"cover",attrs:{src:e.course_cover}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"course_name",label:"课程名称",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"course_name"},[e._v(e._s(t.row.course_name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"上架状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.on?a("el-tag",{attrs:{type:"success"}},[e._v("已上架")]):a("el-tag",{attrs:{type:"info"}},[e._v("未上架")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"是否设置为精品课",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.jingpin?a("el-link",{attrs:{type:"primary"},on:{click:function(a){return e.setJingpin(t.row)}}},[e._v("设置为精品课")]):a("el-link",{attrs:{type:"danger"},on:{click:function(a){return e.cancelJingpin(t.row)}}},[e._v("取消精品课")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"付费类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.pay_type?a("span",[e._v("固定收费")]):e._e(),e._v(" "),2==t.row.pay_type?a("span",[e._v("按天收费")]):e._e(),e._v(" "),3==t.row.pay_type?a("span",[e._v("按月收费")]):e._e(),e._v(" "),4==t.row.pay_type?a("span",[e._v("按年收费")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"价格",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"money"},[1==t.row.pay_type?a("div",{staticClass:"by_time"},[a("strong",[e._v("￥"+e._s(t.row.price.toFixed(2)))])]):2==t.row.pay_type?a("div",{staticClass:"by_time"},[a("strong",[e._v(e._s(t.row.time))]),e._v(" 天"),a("strong",[e._v(" ￥"+e._s(t.row.price.toFixed(2))+" ")])]):3==t.row.pay_type?a("div",{staticClass:"by_time"},[a("strong",[e._v(e._s(t.row.time))]),e._v(" 月"),a("strong",[e._v(" ￥"+e._s(t.row.price.toFixed(2))+" ")])]):4==t.row.pay_type?a("div",{staticClass:"by_time"},[a("strong",[e._v(e._s(t.row.time))]),e._v(" 年"),a("strong",[e._v(" ￥"+e._s(t.row.price.toFixed(2))+" ")])]):e._e()])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"促销价格",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"money"},[1==t.row.pay_type&&t.row.cu_status?a("div",{staticClass:"by_time by_time2"},[a("strong",[e._v("￥"+e._s(t.row.cu_price.toFixed(2)))])]):a("div",[e._v("--")])])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"course_cate_name",label:"课程分类",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"update_time",width:"240",label:"更新时间"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"340",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{staticClass:"editbtn",attrs:{type:"success"},on:{click:function(a){return e.intoEdit(t.row)}}},[e._v("编辑课程")]),e._v(" "),a("el-link",{staticClass:"editbtn",attrs:{type:"success"},on:{click:function(a){return e.jumpPage(t.row)}}},[e._v("管理单课")]),e._v(" "),a("el-dropdown",{staticStyle:{"margin-left":"15px"},attrs:{type:"primary"},on:{command:e.handleSale},scopedSlots:e._u([{key:"dropdown",fn:function(){return[a("el-dropdown-menu",[1==t.row.pay_type&&0==t.row.cu_status?a("el-dropdown-item",{attrs:{command:"a|"+t.row.id}},[e._v("促销")]):e._e(),e._v(" "),1==t.row.pay_type&&1==t.row.cu_status?a("el-dropdown-item",{attrs:{command:"b|"+t.row.id}},[e._v("取消促销")]):e._e()],1)]},proxy:!0}],null,!0)},[a("span",{staticClass:"el-dropdown-link"},[e._v("营销"),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})])]),e._v(" "),a("el-dropdown",{staticStyle:{"margin-left":"15px"},attrs:{type:"success"},on:{command:e.handleCommand},scopedSlots:e._u([{key:"dropdown",fn:function(){return[a("el-dropdown-menu",[a("el-dropdown-item",{attrs:{command:"a|"+t.row.id}},[e._v("新建单课")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"d|"+t.row.id}},[e._v(e._s(1==t.row.on?"下架":"上架"))]),e._v(" "),a("el-dropdown-item",{attrs:{command:"b|"+t.row.id}},[e._v("选择已有单课")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"c|"+t.row.id}},[e._v("进入直播")])],1)]},proxy:!0}],null,!0)},[a("span",{staticClass:"el-dropdown-link"},[e._v("更多"),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})])])]}}])})],1),e._v(" "),a("div",{staticStyle:{"text-align":"center",margin:"30px 0"}},[a("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":e.currentPage,"page-sizes":[5,10,20,30,40,50],"page-size":e.pageSize,total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"新建系列课",visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[a("el-form",{attrs:{model:e.form}},[a("el-form-item",{attrs:{required:"",label:"课程名称","label-width":e.formLabelWidth}},[a("el-input",{model:{value:e.form.course_name,callback:function(t){e.$set(e.form,"course_name",t)},expression:"form.course_name"}})],1),e._v(" "),a("el-form-item",{attrs:{required:"",label:"收费类型","label-width":e.formLabelWidth}},[a("el-radio-group",{on:{change:e.changePayType},model:{value:e.form.pay_type,callback:function(t){e.$set(e.form,"pay_type",t)},expression:"form.pay_type"}},e._l(e.payTypes,function(t){return a("el-radio",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.name))])}),1)],1),e._v(" "),e.showMoney?a("el-form-item",{attrs:{required:"",label:"金额","label-width":e.formLabelWidth}},e._l(e.form.pay_money_type,function(t,r){return a("div",{key:r},[a("el-input",{staticClass:"short_input",model:{value:t.price,callback:function(a){e.$set(t,"price",a)},expression:"item.price"}}),a("span",[e._v(" 元")])],1)}),0):e._e()],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.createCourse}},[e._v("完 成")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"添加已有单课",width:"50%",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-table",{attrs:{data:e.allCourses,"header-cell-style":{"background-color":"#f9fbff",height:"50px",color:"rgba(43,57,64,.85)","border-bottom":"1px #f0f0f0 solid","border-top":"1px #f0f0f0 solid"}},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{type:"course_cover",label:"课程封面",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.course_cover?a("img",{staticClass:"cover",attrs:{width:"100",src:t.row.course_cover}}):a("img",{staticClass:"cover",attrs:{width:"100",src:e.course_cover}})]}}])}),e._v(" "),a("el-table-column",{attrs:{property:"course_name",label:"课程名称",fit:"",height:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.course_name.length>20?t.row.course_name.slice(0,20)+"...":t.row.course_name.slice(0,20)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{property:"create_time",width:"180",label:"创建时间"}})],1),e._v(" "),a("div",{staticStyle:{"text-align":"center",margin:"20px 0 0"}},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":e.aloneCurrentPage,total:e.allCoursesTotal,"page-size":e.alonePageSize},on:{"current-change":e.handleAloneCurrentChange}})],1),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.okAdd}},[e._v("确定添加")])],1),e._v(" "),a("el-dialog",{attrs:{title:"设置促销价格",width:"40%",visible:e.cuxiaoVisible},on:{"update:visible":function(t){e.cuxiaoVisible=t}}},[a("el-form",{attrs:{model:e.saleForm}},[a("el-form-item",{attrs:{required:"",label:"促销价格","label-width":e.formLabelWidth}},[a("el-input",{attrs:{placeholder:"请填写促销价格"},model:{value:e.saleForm.cu_price,callback:function(t){e.$set(e.saleForm,"cu_price",t)},expression:"saleForm.cu_price"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.cuxiaoVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.addCu}},[e._v("完 成")])],1)],1)],1)},staticRenderFns:[]};var _=a("C7Lr")(p,d,!1,function(e){a("vcWm")},"data-v-7b9ee0fe",null);t.default=_.exports},vcWm:function(e,t){}});