webpackJsonp([13],{B5gH:function(e,t){},Knnb:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("lC5x"),s=a.n(r),o=a("J0Oq"),n=a.n(o),c=a("dH21"),i=a("GKsu"),l=a("VLUi"),d=a("aK6G"),u=a("FWz8"),_=a("H4hu"),p={data:function(){return{head:_,activeName:"first",form:{card_no:"",phone:"",name:""},courseInfo:{},detail:{},schedule_id:"",bookList:[],orders:[],ordersTotal:0,queryCards:[]}},mounted:function(){this.schedule_id=this.$route.params.schedule_id,this.queryScheduleById()},methods:{queryScheduleById:function(){var e=this;return n()(s.a.mark(function t(){var a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.query({id:e.schedule_id});case 2:a=t.sent,e.courseInfo=a.data;case 4:case"end":return t.stop()}},t,e)}))()},queryCard:function(){var e=this;return n()(s.a.mark(function t(){var a,r,o,n,c;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.form,r=a.card_no,a.name,a.phone,r||e.$message.error("输入卡号"),t.next=4,i.queryCard({card_no:r});case 4:if(200!=(o=t.sent).code||!o.data.length){t.next=14;break}return e.detail=o.data[0],n=e.detail.member_id,t.next=10,i.query_by_member({member_id:n});case 10:200==(c=t.sent).code&&(e.queryCards=c.data),t.next=15;break;case 14:e.$message.error("信息获取失败，可能卡号输入错误");case 15:case"end":return t.stop()}},t,e)}))()},cardNoChange:function(e){this.queryCard()},fetchOrders:function(){var e=this;return n()(s.a.mark(function t(){var a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.list({order_course_type:2,order_course_id:e.schedule_id});case 2:200==(a=t.sent).code&&(e.orders=a.data.list,e.ordersTotal=a.data.total);case 4:case"end":return t.stop()}},t,e)}))()},fetchBookList:function(){var e=this;return n()(s.a.mark(function t(){var a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.list({book_course_type:2,book_course_id:e.schedule_id});case 2:200==(a=t.sent).code&&(e.bookList=a.data.list);case 4:case"end":return t.stop()}},t,e)}))()},addBook:function(){var e=this;return n()(s.a.mark(function t(){var a,r,o,n,c,i,u,_,p,m;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.detail.card_id,r=e.form.card_no){t.next=5;break}return e.$message.error("没有设置卡的信息"),t.abrupt("return");case 5:return o=e.courseInfo.teacher,t.next=8,l.sijiao_cardinfo({id:o});case 8:if(n=t.sent,c=n.data.support_cardinfo.split(","),i=!1,(c=c.map(function(e){var t=e.split("_");return{card_id:t[0],price:t[1]}})).forEach(function(e){e.card_id==a&&(i=!0)}),i){t.next=16;break}return e.$message.error("此卡不能预约该私教课，请选择其他卡"),t.abrupt("return");case 16:return u=e.courseInfo.id,_=e.detail.member_id,p=2,t.next=21,d.add({book_card_no:r,book_course_id:u,book_member_id:_,book_course_type:p});case 21:200==(m=t.sent).code?(e.$message.success(m.msg),e.activeName="second",e.fetchBookList()):console.log(m);case 23:case"end":return t.stop()}},t,e)}))()},qiaodao:function(e){var t=this;return n()(s.a.mark(function a(){var r,o;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return r="",e.support_cardinfo.split(",").map(function(e){var t=e.split("_");return{card_id:t[0],price:t[1]}}).forEach(function(t){t.card_id==e.card_id&&(r=parseFloat(t.price))}),a.next=6,u.add({book_id:e.id,order_card_no:e.book_card_no,order_course_id:e.book_course_id,order_course_type:e.book_course_type,order_member_id:e.member_id,order_remark:"",order_cost:r,cost_type:e.type});case 6:200==(o=a.sent).code?(t.fetchBookList(),t.$message.success(o.msg)):console.log(o);case 8:case"end":return a.stop()}},a,t)}))()},cancelCourse:function(e){var t=this;return n()(s.a.mark(function a(){var r;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,d.cancel({id:e});case 2:200==(r=a.sent).code?(t.$message.success(r.msg),t.fetchBookList()):console.log(r);case 4:case"end":return a.stop()}},a,t)}))()},cancelOrder:function(e){var t=this;return n()(s.a.mark(function a(){var r;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,u.cancel({id:e});case 2:200==(r=a.sent).code?(t.$message.success(r.msg),t.fetchOrders()):console.log(r);case 4:case"end":return a.stop()}},a,t)}))()},jump:function(){this.$router.push({path:"/membercard/detail/"+this.form.card_no})},cancelAction:function(){this.$store.dispatch("tagsView/delView",this.$route),this.$router.back()},handleClick:function(e,t){"first"==e.paneName||("second"==e.paneName?this.fetchBookList():"third"==e.paneName&&this.fetchOrders())}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wrap"},[a("h3",[e._v(e._s(e.courseInfo.teacher_name)+" - 私教课 "+e._s(e.courseInfo.date&&e.courseInfo.date.slice(0,11))+" "+e._s(e.courseInfo.start_time)+"至"+e._s(e.courseInfo.end_time)+" ")]),e._v(" "),a("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"预约",name:"first"}},[a("div",{staticClass:"first_box"},[a("div",{staticClass:"left"},[a("el-form",{attrs:{"label-width":"80px"}},[a("el-form-item",{attrs:{label:"卡号："}},[a("el-input",{attrs:{placeholder:"请输入卡号"},model:{value:e.form.card_no,callback:function(t){e.$set(e.form,"card_no",t)},expression:"form.card_no"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"姓名："}},[a("span",[e._v(e._s(e.detail.name))])]),e._v(" "),a("el-form-item",{attrs:{label:"手机："}},[a("span",[e._v(e._s(e.detail.phone))])]),e._v(" "),e.queryCards.length?a("el-form-item",{attrs:{label:"选择卡："}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择其他卡"},on:{change:e.cardNoChange},model:{value:e.form.card_no,callback:function(t){e.$set(e.form,"card_no",t)},expression:"form.card_no"}},e._l(e.queryCards,function(e){return a("el-option",{key:e.card_no,attrs:{label:e.card_name,value:e.card_no}})}),1)],1):e._e(),e._v(" "),a("br"),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.queryCard}},[e._v("查 询")])],1)],1)],1),e._v(" "),a("div",{staticClass:"right"},[a("div",{staticClass:"item"},[a("label",[e._v("课程：")]),e._v(" "),a("span",[e._v(e._s(e.courseInfo.teacher_name)+" - 私教课")])]),e._v(" "),a("div",{staticClass:"item"},[a("label",[e._v("卡名称：")]),e._v(" "),a("span",[e._v(e._s(e.detail.card_name))])]),e._v(" "),a("div",{staticClass:"item"},[a("label",[e._v("状态：")]),e._v(" "),0==e.detail.status?a("span",[e._v("未开卡")]):1==e.detail.status?a("span",[e._v("正常")]):2==e.detail.status?a("span",[e._v("已用完")]):a("span")]),e._v(" "),a("div",{staticClass:"item"},[a("label",[e._v("剩余：")]),e._v(" "),1==e.detail.type?a("span",[e._v(e._s(e.detail.surplus)+"次")]):6==e.detail.type?a("span",[e._v(e._s(e.detail.surplus)+"元")]):7==e.detail.type?a("span",[e._v(e._s(e.detail.surplus)+"小时")]):2==e.detail.type?a("span",[e._v("年卡")]):3==e.detail.type?a("span",[e._v("季卡")]):4==e.detail.type?a("span",[e._v("月卡")]):5==e.detail.type?a("span",[e._v("周卡")]):e._e()]),e._v(" "),a("div",{staticClass:"item"},[a("label",[e._v("开卡时间：")]),e._v(" "),a("span",[e._v(e._s(e.detail.open_start_time&&e.detail.open_start_time.slice(0,11)))])]),e._v(" "),a("div",{staticClass:"item"},[a("label",[e._v("到期时间：")]),e._v(" "),a("span",[e._v(e._s(e.detail.open_end_time&&e.detail.open_end_time.slice(0,11)))])]),e._v(" "),a("div",{staticClass:"item"},[a("label",[e._v("私教时间：")]),e._v(" "),a("span",[e._v(e._s(e.courseInfo.minutes)+" 分钟")])]),e._v(" "),e.form.card_no?a("div",{staticClass:"item"},[a("el-link",{attrs:{type:"danger"},on:{click:function(t){return e.jump()}}},[e._v("查看更多")])],1):e._e()])]),e._v(" "),a("el-divider"),e._v(" "),a("el-button-group",[a("el-button",{attrs:{type:"primary"},on:{click:e.addBook}},[e._v("预约")]),e._v(" "),a("el-button",{attrs:{type:"info"},on:{click:e.cancelAction}},[e._v("取消")])],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"已预约",name:"second"}},[a("el-table",{attrs:{data:e.bookList,border:"","header-cell-style":{color:"#333","background-color":"#f5f5f5"}}},[a("el-table-column",{attrs:{prop:"head",width:"80",label:"头像"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"head"},[t.row.head?a("img",{attrs:{src:t.row.head,alt:"头像"}}):a("img",{attrs:{src:e.head,alt:"头像"}})])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",width:"150",label:"预约人"}}),e._v(" "),a("el-table-column",{attrs:{prop:"phone",width:"150",label:"电话"}}),e._v(" "),a("el-table-column",{attrs:{prop:"book_card_no",width:"150",label:"卡号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"card_name",width:"150",label:"卡名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"teacher_name",width:"120",label:"教练"}}),e._v(" "),a("el-table-column",{attrs:{prop:"book_time",width:"180",label:"预约时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.book_time&&t.row.book_time.slice(0,16)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"book_time",width:"180",label:"上课时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.date&&t.row.date.slice(0,11))+" "+e._s(t.row.start_time))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"预约状态",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.book_status?a("span",[e._v("预约成功")]):a("span",[e._v("学员预约取消")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",fixed:"right",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.qiandao_status&&1==t.row.book_status?a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){return e.qiaodao(t.row)}}},[a("span",[e._v("签到")])]):e._e(),e._v(" "),1==t.row.qiandao_status&&1==t.row.book_status?a("span",[e._v("已上课")]):e._e(),e._v(" "),1==t.row.book_status&&0==t.row.qiandao_status?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.cancelCourse(t.row.id)}}},[a("span",[e._v("取消预约")])]):e._e(),e._v(" "),2==t.row.book_status&&0==t.row.qiandao_status?a("span",[e._v("预约被取消")]):e._e()]}}])})],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"已消费",name:"third"}},[a("el-table",{attrs:{data:e.orders,border:"","header-cell-style":{color:"#333","background-color":"#f5f5f5"}}},[a("el-table-column",{attrs:{prop:"head",width:"80",label:"头像"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"head"},[t.row.head?a("img",{attrs:{src:t.row.head,alt:"头像"}}):a("img",{attrs:{src:e.head,alt:"头像"}})])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",width:"150",label:"姓名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"phone",width:"150",label:"手机号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"order_card_no",width:"150",label:"卡号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"card_name",width:"150",label:"卡名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"order_time",width:"200",label:"签到时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.order_time&&t.row.order_time.slice(0,16)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"上课时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.date&&t.row.date.slice(0,11))+" "+e._s(t.row.start_time))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"消费",fixed:"right",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.cost_type?a("span",[e._v(e._s(t.row.order_cost)+" 次")]):6==t.row.cost_type?a("span",[e._v(e._s(t.row.order_cost)+" 元")]):7==t.row.cost_type?a("span",[e._v(e._s(t.row.order_cost)+" 小时")]):2==t.row.cost_type?a("span",[e._v("年卡")]):3==t.row.cost_type?a("span",[e._v("季卡")]):4==t.row.cost_type?a("span",[e._v("月卡")]):5==t.row.cost_type?a("span",[e._v("周卡")]):e._e()]}}])})],1)],1)],1)],1)},staticRenderFns:[]};var f=a("C7Lr")(p,m,!1,function(e){a("B5gH")},"data-v-5def7a49",null);t.default=f.exports},dH21:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.list=function(e){return Object(r.a)({url:"/admin/trainerschedule/list",method:"get",params:e})},t.add=function(e){return Object(r.a)({url:"/admin/trainerschedule/add",method:"post",data:e})},t.update=function(e){return Object(r.a)({url:"/admin/trainerschedule/update",method:"put",data:e})},t.query=function(e){return Object(r.a)({url:"/admin/trainerschedule/query",method:"get",params:e})},t.updateStatus=function(e){return Object(r.a)({url:"/admin/trainerschedule/status",method:"put",data:e})},t.deleteClass=function(e){return Object(r.a)({url:"/admin/trainerschedule/delete",method:"delete",params:e})};var r=a("vLgD")}});